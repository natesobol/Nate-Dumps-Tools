<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PDF Merger | Monetize Hub</title>
    <meta
      name="description"
      content="Merge multiple small PDF files directly in your browser. Upload files, combine them vertically, and download a single merged PDF without installing anything."
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="../../public/css/styles.css" />
  </head>
  <body>
    <header class="site-header">
      <div class="header-top">
        <a class="brand" href="../../index.html">
          <img src="../../public/logo.png" alt="Monetize Hub" class="brand-logo" />
          <div class="brand-text">
            <span class="brand-name">Monetize Hub</span>
            <span class="brand-tagline">Launch, host, and grow your webapps</span>
          </div>
        </a>
        <details class="nav-dropdown user-dropdown" open>
          <summary class="nav-link nav-dropdown-toggle">
            <span class="user-label">Account</span>
            <span aria-hidden="true">▾</span>
          </summary>
          <div class="nav-dropdown-menu">
            <a href="../../login.html" class="dropdown-link">Login</a>
            <a href="../../register.html" class="dropdown-link">Create Account</a>
            <a href="../../admin.html" class="dropdown-link">Admin Dashboard</a>
          </div>
        </details>
      </div>
      <nav class="main-nav">
        <a href="../../index.html" class="nav-link">Home</a>
        <a href="../../about.html" class="nav-link">About</a>
        <details class="nav-dropdown" open>
          <summary class="nav-link nav-dropdown-toggle">Webapps <span aria-hidden="true">▾</span></summary>
          <div class="nav-dropdown-menu">
            <a href="../excel-to-json/index.html" class="dropdown-link">Excel → JSON</a>
            <a href="../json-combiner/wwwroot/index.html" class="dropdown-link">JSON Combiner</a>
            <a href="../csv-xml-converter/index.html" class="dropdown-link">CSV/XML Converter</a>
            <a href="./index.html" class="dropdown-link active">PDF Merger</a>
          </div>
        </details>
      </nav>
    </header>

    <main class="page-body">
      <section class="tool-hero">
        <div>
          <p class="eyebrow">PDF Merger</p>
          <h1>Append multiple PDFs into a single, ready-to-share file.</h1>
          <p class="lede">
            Inspired by Sobolsoft's Join Multiple PDF Files Into One Software, this browser-based utility stacks your PDFs
            vertically in the order you choose. Drop in a handful of small files and download one merged document without any
            installs.
          </p>
          <ul class="trust-points">
            <li>Runs 100% in your browser—no uploads are stored or sent to a server.</li>
            <li>Preserves every page and stacks them in the sequence you provide.</li>
            <li>Ideal for combining receipts, proposals, or reports on the fly.</li>
          </ul>
        </div>
        <div class="converter-card">
          <form id="mergeForm">
            <label for="pdfFiles">Select 2–10 PDF files</label>
            <input
              type="file"
              id="pdfFiles"
              name="pdfFiles"
              accept="application/pdf"
              multiple
              aria-describedby="fileHelp"
            />
            <p class="help-text" id="fileHelp">Choose smaller PDFs (under ~3 MB each) for the fastest merging experience.</p>
            <div id="fileList" class="file-list help-text" style="white-space: pre-line">No files selected yet.</div>
            <button type="submit" class="button primary btn btn-primary btn-modern full-width" id="mergeButton">Merge now</button>
            <button type="button" class="button ghost btn btn-outline-light btn-modern full-width mt-2" id="downloadButton" disabled>
              Download merged PDF
            </button>
            <p class="help-text">Your merged file stays client-side. Reload the page to clear everything.</p>
          </form>
          <div id="status" class="flash" role="status" aria-live="polite" style="display: none"></div>
          <div id="summary" class="result-card" style="display: none">
            <h2>Merge summary</h2>
            <p class="help-text" id="summaryText"></p>
            <p class="help-text" id="sizeText"></p>
          </div>
        </div>
      </section>

      <section class="result-panel">
        <div class="result-card">
          <h2>How vertical merging works</h2>
          <ul class="checklist">
            <li>Files are processed in the exact order they appear in the picker—reorder there to change the stack.</li>
            <li>Each PDF's pages are copied into a fresh document so nothing overwrites or resizes existing content.</li>
            <li>The final download uses a timestamped filename you can share or archive immediately.</li>
            <li>If you hit memory limits, split the job into two runs and merge the results.</li>
          </ul>
        </div>
        <div class="result-card">
          <h2>Privacy-first processing</h2>
          <p class="help-text">
            The merger relies on <code>PDF-LIB</code> running in your browser. No pages leave your device, and you can safely use it
            on offline or low-connectivity machines when the page is cached.
          </p>
          <p class="help-text">Need an audit trail? Save the merged file name and timestamp generated in the download dialog.</p>
        </div>
      </section>
    </main>

    <footer class="site-footer">
      <p>Built for Monetize Hub. Combine PDFs on-demand without desktop installs.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js" crossorigin="anonymous"></script>
    <script>
      const fileInput = document.getElementById('pdfFiles');
      const mergeForm = document.getElementById('mergeForm');
      const mergeButton = document.getElementById('mergeButton');
      const downloadButton = document.getElementById('downloadButton');
      const fileList = document.getElementById('fileList');
      const status = document.getElementById('status');
      const summary = document.getElementById('summary');
      const summaryText = document.getElementById('summaryText');
      const sizeText = document.getElementById('sizeText');

      let mergedBytes = null;
      let downloadUrl = null;

      function formatBytes(bytes) {
        if (!bytes) return '0 B';
        const units = ['B', 'KB', 'MB', 'GB'];
        const exponent = Math.min(Math.floor(Math.log(bytes) / Math.log(1024)), units.length - 1);
        const value = bytes / 1024 ** exponent;
        return `${value.toFixed(value >= 10 || value % 1 === 0 ? 0 : 1)} ${units[exponent]}`;
      }

      function renderFileList(files) {
        if (!files.length) {
          fileList.textContent = 'No files selected yet.';
          return;
        }

        const lines = Array.from(files).map((file, index) => `${index + 1}. ${file.name} (${formatBytes(file.size)})`);
        fileList.textContent = lines.join('\n');
      }

      function setStatus(message, type = 'info') {
        status.textContent = message;
        status.className = `flash flash-${type}`;
        status.style.display = 'block';
      }

      function clearStatus() {
        status.style.display = 'none';
        status.textContent = '';
      }

      async function mergePdfs(files) {
        const { PDFDocument } = PDFLib;
        const mergedPdf = await PDFDocument.create();
        let pageCount = 0;

        for (const file of files) {
          if (file.type && file.type !== 'application/pdf') {
            throw new Error(`"${file.name}" is not a PDF file.`);
          }

          const arrayBuffer = await file.arrayBuffer();
          const pdf = await PDFDocument.load(arrayBuffer);
          const pages = await mergedPdf.copyPages(pdf, pdf.getPageIndices());

          pages.forEach((page) => mergedPdf.addPage(page));
          pageCount += pages.length;
        }

        mergedBytes = await mergedPdf.save();
        if (downloadUrl) {
          URL.revokeObjectURL(downloadUrl);
        }
        downloadUrl = URL.createObjectURL(new Blob([mergedBytes], { type: 'application/pdf' }));

        return { filesMerged: files.length, pageCount };
      }

      mergeForm.addEventListener('submit', async (event) => {
        event.preventDefault();
        const files = Array.from(fileInput.files || []);

        clearStatus();
        summary.style.display = 'none';
        downloadButton.disabled = true;

        if (files.length < 2) {
          setStatus('Select at least two PDF files to merge.', 'error');
          return;
        }

        if (files.length > 10) {
          setStatus('For best performance, merge up to 10 PDFs at a time.', 'warning');
          return;
        }

        mergeButton.disabled = true;
        mergeButton.textContent = 'Merging…';
        setStatus('Working in your browser — copying pages and building a new PDF.', 'info');

        try {
          const { filesMerged, pageCount } = await mergePdfs(files);
          summaryText.textContent = `Merged ${filesMerged} file${filesMerged === 1 ? '' : 's'} into ${pageCount} page${
            pageCount === 1 ? '' : 's'
          }.`;
          sizeText.textContent = `Estimated download size: ${formatBytes(mergedBytes?.byteLength)}`;
          summary.style.display = 'block';
          setStatus('Merge complete. Download your combined PDF below.', 'success');
          downloadButton.disabled = false;
        } catch (error) {
          console.error(error);
          setStatus(error.message || 'Something went wrong while merging. Please try smaller files or fewer at a time.', 'error');
          mergedBytes = null;
        } finally {
          mergeButton.disabled = false;
          mergeButton.textContent = 'Merge now';
        }
      });

      downloadButton.addEventListener('click', () => {
        if (!downloadUrl || !mergedBytes) return;

        const link = document.createElement('a');
        link.href = downloadUrl;
        link.download = `merged-${Date.now()}.pdf`;
        link.style.display = 'none';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      });

      fileInput.addEventListener('change', (event) => {
        const files = Array.from(event.target.files || []);
        mergedBytes = null;
        downloadButton.disabled = true;
        summary.style.display = 'none';
        if (downloadUrl) {
          URL.revokeObjectURL(downloadUrl);
          downloadUrl = null;
        }
        renderFileList(files);
        clearStatus();
      });
    </script>
  </body>
</html>
